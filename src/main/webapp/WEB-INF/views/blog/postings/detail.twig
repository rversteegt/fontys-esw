{% extends 'blog/main.twig' %}

{% block body %}     
    {% if options.getVisibility.toString == "ADVANCED" %}
        <form action="/app/blog/edit/{{ posting.getId }}" method="post">
            <table>
                <tr>
                    <td>
                        Titel
                    </td>                
                    <td>
                        <input type="text" name="title" value="{{ posting.getPosting.title }}"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        Bericht
                    </td>                
                    <td>
                        <textarea name="message">
                            {{ posting.getPosting.message }}
                        </textarea>
                    </td>
                </tr>
            </table>
        </form>   
    {% else %}
        <h1>
            {{ posting.getPosting.title }}
        </h1>

        <p>
            {{ posting.getPosting.message }}
        </p>        
    {% endif %}
    
    <h2>
        Reageersels
    </h2>

    <div id="responses">
        {% for comment in posting.getPosting.comments %}
            <i>
                {{ comment.getTimestamp|date("dd-MM-yyyy") }}
            </i>
            <p>
                {{ comment.getMessage }}
            </p>
        {% else %}
            <p>
                Nog niemand heeft gereageerd.
                Schande.
            </p>
        {% endfor %}
    </div>
    
    <form id="addComment" action="/app/blog/addCommentToPosting/{{ posting.getId }}" method="post">
        <table>           
            <tr>
                <td>
                    Reageer
                </td>                
                <td>
                    <textarea name="message"></textarea>
                </td>
            </tr>
        </table>
        
        <input type="submit" value="stuur op"/>
    </form>

        <script>
            $(function() {
                $("#addComment").submit(function(e){
                    e.preventDefault();

                    var $message = $(this).find("textarea[name='message']");
                    var $responses = $("#responses");

                    $.ajax(
                        {
                            url : '/app/api/blog/addCommentToPosting/{{ id }}',
                            method : 'POST',
                            data : {
                                message : $message.val()
                            },
                            error : function(error) {
                            },
                            success : function(response) {
                                var comments = response.posting.comments;

                                $responses.html('');
                                $message.val('');

                                $.each(comments, function(k, comment) {
                                    $responses.append('<i>' + moment(comment.timestamp).format('D-M-YYYY') + '</i><p>' + comment.message + '</p>');
                                });

                            },
                            complete : function() {
                            },
                        }
                    );
                });
            });

        </script>

    {% if options.getVisibility.toString == "ADVANCED" %}
        <form action="/app/blog/delete/{{ posting.getId }}" method="post">
            <input type="submit" value="Verwijder"/>
        </form>
    {% endif %}
    
{% endblock %}